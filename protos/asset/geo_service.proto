// ============================================================================
// /asset/geo-service (版本 2.0)
// 描述: 提供地理空间功能，如资产定位、地理围栏和路线规划。
// ============================================================================

syntax = "proto3";

package enterprise.asset.geo;

option java_package = "com.enterprise.asset.geo.v2";
option java_multiple_files = true;
option go_package = "github.com/enterprise-extensions/asset/geo/v2;geo";

import "common/common.proto";
import "google/protobuf/timestamp.proto";

// ============================================================================
// 服务定义: GeoService
// ============================================================================

service GeoService {
  // 获取资产的最后已知位置
  rpc GetAssetLocation(GetAssetLocationRequest) returns (AssetLocation);
  
  // 更新资产位置 (New)
  rpc UpdateAssetLocation(UpdateAssetLocationRequest) returns (UpdateLocationResponse);

  // 检查资产是否在指定的地理围栏内
  rpc CheckGeofence(CheckGeofenceRequest) returns (CheckGeofenceResponse);
  
  // 创建地理围栏 (New)
  rpc CreateGeofence(CreateGeofenceRequest) returns (GeofenceResponse);

  // 计算两个地理点之间的路线 - 异步
  rpc CalculateRoute(CalculateRouteRequest) returns (enterprise.common.JobInfo);
  
  // 获取路线计算结果 (New)
  rpc GetRouteResult(GetRouteResultRequest) returns (Route);
}

// ============================================================================
// 数据结构: Geo (地理)
// ============================================================================

// 地理坐标
message GeoPoint {
  double latitude = 1;
  double longitude = 2;
}

// 资产位置
message AssetLocation {
  string asset_id = 1;
  GeoPoint location = 2;
  google.protobuf.Timestamp timestamp = 3;
}

// 地理围栏
message Geofence {
  string fence_id = 1;
  string name = 2;
  repeated GeoPoint vertices = 3; // Polygon
  string description = 4;
}

// 路线
message Route {
  double distance_meters = 1;
  int64 duration_seconds = 2;
  repeated RouteStep steps = 3;
}

// 路线步骤
message RouteStep {
  string instruction = 1;
  double distance_meters = 2;
}

// ============================================================================
// RPC 消息定义
// ============================================================================

// 获取资产位置请求
message GetAssetLocationRequest {
  string asset_id = 1;
  enterprise.common.RequestContext context = 99;
}

message UpdateAssetLocationRequest {
  string asset_id = 1;
  GeoPoint location = 2;
  google.protobuf.Timestamp timestamp = 3;
  enterprise.common.RequestContext context = 99;
}

message UpdateLocationResponse {
  bool success = 1;
  enterprise.common.ApiMessage message = 2;
}

// 检查地理围栏请求
message CheckGeofenceRequest {
  string asset_id = 1;
  string fence_id = 2;
  enterprise.common.RequestContext context = 99;
}

message CheckGeofenceResponse {
  bool is_inside = 1;
}

message CreateGeofenceRequest {
  string name = 1;
  repeated GeoPoint vertices = 2;
  string description = 3;
  enterprise.common.RequestContext context = 99;
}

message GeofenceResponse {
  bool success = 1;
  string fence_id = 2;
}

// 计算路线请求
message CalculateRouteRequest {
  GeoPoint start = 1;
  GeoPoint end = 2;
  enterprise.common.TravelMode travel_mode = 3;
  enterprise.common.RequestContext context = 99;
}

message GetRouteResultRequest {
  string job_id = 1;
  enterprise.common.RequestContext context = 99;
}
