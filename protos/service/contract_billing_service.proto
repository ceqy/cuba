// ============================================================================
// /service/contract-billing-service (版本 2.0)
// 描述: 管理服务合同的计费计划和发票创建。
// ============================================================================

syntax = "proto3";

package enterprise.service.billing;

option java_package = "com.enterprise.service.billing.v2";
option java_multiple_files = true;
option go_package = "github.com/enterprise-extensions/service/billing/v2;billing";

import "google/protobuf/timestamp.proto";
import "common/common.proto";

// ============================================================================
// 服务定义: ContractBillingService
// ============================================================================

service ContractBillingService {
  // 获取服务合同详情
  rpc GetServiceContract(GetServiceContractRequest) returns (ServiceContractDetail);

  // 执行计费运行
  rpc RunBilling(RunBillingRequest) returns (RunBillingResponse);
}

// ============================================================================
// 数据结构: ServiceContract (服务合同)
// ============================================================================

// 服务合同详情
message ServiceContractDetail {
  // 合同号
  string contract_number = 1;
  // 客户编号
  string customer_id = 2;
  // 有效期
  enterprise.common.DateRange validity_period = 3;
  // 计费计划
  repeated BillingPlanItem billing_plan = 4;
}

// 计费计划项
message BillingPlanItem {
  // 计划计费日期
  google.protobuf.Timestamp planned_billing_date = 1;
  // 计费金额
  enterprise.common.MonetaryValue billing_amount = 2;
  // 是否已计费
  bool is_billed = 3;
  // 生成的发票号
  string invoice_number = 4;
}

// ============================================================================
// RPC 消息定义
// ============================================================================

// 获取服务合同请求
message GetServiceContractRequest {
  // 合同号
  string contract_number = 1;
}

// 执行计费运行请求
message RunBillingRequest {
  // 计费截止日期
  google.protobuf.Timestamp billing_until_date = 1;
  // 要计费的合同号 (可选, 如果为空则处理所有到期合同)
  repeated string contract_numbers = 2;
}

// 执行计费运行响应
message RunBillingResponse {
  // 运行ID
  string run_id = 1;
  // 生成的发票数量
  int32 invoices_created = 2;
  // 从核心ERP返回的消息列表
  repeated enterprise.common.ApiMessage messages = 3;
}
