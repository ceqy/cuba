// ============================================================================
// /events/events.proto (版本 2.2 - Production Ready)
// 描述: 定义跨微服务通信的业务事件，遵循 CloudEvents 1.0 规范。
//       整合了 Finance, SC, Manufacturing, Asset, HR 等全域事件。
// ============================================================================

syntax = "proto3";

package events.v1;

option go_package = "github.com/enterprise/erp/protos/events;events";


import "google/protobuf/timestamp.proto";
import "common/common.proto";
// import "validate/validate.proto"; // 如果环境支持 PGV，可取消注释

// ============================================================================
// CloudEvents 1.0 包装器
// ============================================================================

message CloudEvent {
  string specversion = 1; // "1.0"
  string id = 2;
  string source = 3;      // urn:service:{domain}.{service}
  string type = 4;        // enterprise.{domain}.{entity}.{action}Event
  google.protobuf.Timestamp time = 5;
  string subject = 6;
  string datacontenttype = 7; // "application/protobuf"
  string dataschema = 8;
  string event_version = 9;   // Semver
  
  // Tracing
  string trace_id = 10;
  string span_id = 11;
  string correlation_id = 12;
  
  // Tenant
  string tenant_id = 13;
  
  map<string, string> extensions = 14;

  // Payload OneOf
  oneof data {
    // Finance (20-29)
    JournalEntryPostedEvent journal_entry_posted = 20;
    InvoicePostedEvent invoice_posted = 21;
    PaymentReceivedEvent payment_received = 22;
    CostSettlementEvent cost_settlement = 23;
    AssetDepreciatedEvent asset_depreciated = 24;
    
    // Procurement (30-39)
    PurchaseOrderReleasedEvent purchase_order_released = 30;
    ContractSignedEvent contract_signed = 31;
    SourcingEventCompletedEvent sourcing_completed = 32;
    SupplierOnboardedEvent supplier_onboarded = 33;

    // Sales (40-49)
    SalesOrderCreatedEvent sales_order_created = 40;
    RevenueRecognizedEvent revenue_recognized = 41;
    PricingUpdatedEvent pricing_updated = 42;
    
    // Supply Chain (50-59)
    StockChangedEvent stock_changed = 50;
    ShipmentDeliveredEvent shipment_delivered = 51;
    TransferOrderConfirmedEvent transfer_order_confirmed = 52;
    DemandForecastPublishedEvent forecast_published = 53;

    // Manufacturing (60-69)
    ProductionOrderReleasedEvent production_order_released = 60;
    UsageDecisionMadeEvent usage_decision_made = 61;
    KanbanSignalEvent kanban_signal = 62;
    WorkOrderCompletedEvent work_order_completed = 63;

    // Asset Management (70-79)
    MaintenanceNotificationCreatedEvent maintenance_notification_created = 70;
    MaintenanceOrderReleasedEvent maintenance_order_released = 71;
    MachineHealthAlertEvent health_alert = 72;
    IncidentReportedEvent incident_reported = 73;

    // RD (80-89)
    BoMReleasedEvent bom_released = 80;
    ProjectWBSCreatedEvent wbs_created = 81;

    // HR (90-99)
    EmployeeSurveyCompletedEvent employee_survey_completed = 90;
    CandidateHiredEvent candidate_hired = 91;
    PayrollProcessedEvent payroll_processed = 92;
    
    // Service (100-109)
    ServiceOrderCompletedEvent service_order_completed = 100;
    WarrantyClaimFiledEvent warranty_claim_filed = 101;
    ContractBilledEvent contract_billed = 102;

    // IAM (110-119)
    UserLoginEvent user_login = 110;
  }
}

// ============================================================================
// 1. Finance Domain Events
// ============================================================================

// 总账凭证已过账
message JournalEntryPostedEvent {
  string company_code = 1;
  string fiscal_year = 2;
  string document_number = 3;
  google.protobuf.Timestamp posting_date = 4;
  common.v1.MonetaryValue total_debit = 5;
  common.v1.MonetaryValue total_credit = 6;
}

// 发票已过账
message InvoicePostedEvent {
  string company_code = 1;
  string invoice_number = 2;
  string fiscal_year = 3;
  string customer_or_vendor_id = 4;
  common.v1.MonetaryValue invoice_amount = 5;
  google.protobuf.Timestamp posting_date = 6;
  string invoice_type = 7; // "AR_INVOICE" or "AP_INVOICE"
}

// 收款已确认
message PaymentReceivedEvent {
  string company_code = 1;
  string payment_reference = 2;
  string customer_id = 3;
  common.v1.MonetaryValue amount = 4;
  google.protobuf.Timestamp clear_date = 5;
}

// 成本结算完成
message CostSettlementEvent {
  string controlling_area = 1;
  string settlement_document = 2;
  string sender_object = 3;
  string receiver_object = 4;
  common.v1.MonetaryValue settlement_amount = 5;
}

// 资产折旧已计提
message AssetDepreciatedEvent {
  string company_code = 1;
  string asset_number = 2;
  string fiscal_period = 3;
  common.v1.MonetaryValue amount = 4;
}

// ============================================================================
// 2. Procurement Domain Events
// ============================================================================

// 采购订单已下达
message PurchaseOrderReleasedEvent {
  string purchase_order_number = 1;
  string vendor_id = 2;
  google.protobuf.Timestamp order_date = 3;
  common.v1.MonetaryValue total_value = 4;
  string purchasing_org = 5;
  string company_code = 6;
}

// 合同已签署
message ContractSignedEvent {
  string contract_number = 1;
  string vendor_id = 2;
  google.protobuf.Timestamp valid_from = 3;
  google.protobuf.Timestamp valid_to = 4;
  common.v1.MonetaryValue target_value = 5;
}

// 寻源事件已完成
message SourcingEventCompletedEvent {
  string sourcing_id = 1;
  string winning_bidder = 2;
  common.v1.MonetaryValue final_amount = 3;
  string invitation_id = 4;
}

// 供应商已入驻
message SupplierOnboardedEvent {
  string vendor_id = 1;
  string vendor_name = 2;
  string country = 3;
  google.protobuf.Timestamp onboard_date = 4;
}

// ============================================================================
// 3. Sales Domain Events
// ============================================================================

// 销售订单已创建
message SalesOrderCreatedEvent {
  string sales_order_number = 1;
  string sold_to_party = 2;
  google.protobuf.Timestamp order_date = 3;
  common.v1.MonetaryValue net_value = 4;
  string sales_org = 5;
  common.v1.OrderType order_type = 6;
}

// 收入已确认
message RevenueRecognizedEvent {
  string sales_order_number = 1;
  string fiscal_period = 2;
  common.v1.MonetaryValue amount = 3;
  string recognition_method = 4;
}

// 定价已更新
message PricingUpdatedEvent {
  string material = 1;
  string sales_org = 2;
  common.v1.MonetaryValue new_price = 3;
  google.protobuf.Timestamp effective_from = 4;
}

// ============================================================================
// 4. Supply Chain / Inventory Events
// ============================================================================

// 库存变更
message StockChangedEvent {
  string material = 1;
  string plant = 2;
  string storage_location = 3;
  string batch = 4;
  common.v1.MovementType movement_type = 5;
  common.v1.QuantityValue quantity = 6;
  string material_document = 7;
  google.protobuf.Timestamp posting_date = 8;
}

// 货物已送达
message ShipmentDeliveredEvent {
  string shipment_number = 1;
  string carrier_id = 2;
  google.protobuf.Timestamp delivery_time = 3;
}

// 移库单已确认
message TransferOrderConfirmedEvent {
  string warehouse_number = 1;
  string transfer_order_number = 2;
}

// 需求预测已发布
message DemandForecastPublishedEvent {
  string material = 1;
  string plant = 2;
  string version = 3;
  google.protobuf.Timestamp start_date = 4;
}

// ============================================================================
// 5. Manufacturing Domain Events
// ============================================================================

// 生产订单已下达
message ProductionOrderReleasedEvent {
  string order_number = 1;
  string material = 2;
  string plant = 3;
  common.v1.QuantityValue target_quantity = 4;
}

// 质量使用决策已做出
message UsageDecisionMadeEvent {
  string inspection_lot_number = 1;
  common.v1.UsageDecision decision_code = 2;
}

// 看板信号切换
message KanbanSignalEvent {
  string kanban_id = 1;
  string status_to = 2;
}

// 工单报工完成
message WorkOrderCompletedEvent {
  string order_number = 1;
  string operation_number = 2;
  common.v1.QuantityValue yield_quantity = 3;
}

// ============================================================================
// 6. Asset Management Events
// ============================================================================

// 维护通知已创建
message MaintenanceNotificationCreatedEvent {
  string notification_number = 1;
  string equipment_number = 2;
}

// 维护订单已下达
message MaintenanceOrderReleasedEvent {
  string order_number = 1;
  string equipment_number = 2;
}

// 设备健康告警
message MachineHealthAlertEvent {
  string equipment_number = 1;
  string alert_type = 2;
  string severity = 3;
}

// EHS事件已报告
message IncidentReportedEvent {
  string incident_id = 1;
  string location = 2;
  string type = 3;
}

// ============================================================================
// 7. R&D Domain Events
// ============================================================================

// 物料清单已发布
message BoMReleasedEvent {
  string material = 1;
  string plant = 2;
}

// 项目WBS已创建
message ProjectWBSCreatedEvent {
  string project_id = 1;
  string wbs_element = 2;
}

// ============================================================================
// 8. HR Domain Events
// ============================================================================

// 员工调查已完成
message EmployeeSurveyCompletedEvent {
  string survey_id = 1;
  string employee_id = 2;
}

// 候选人已录用
message CandidateHiredEvent {
  string candidate_id = 1;
  string vacancy_id = 2;
}

// 薪资计算完成
message PayrollProcessedEvent {
  string company_code = 1;
  string payroll_area = 2;
  string period = 3;
}

// ============================================================================
// 9. Service Domain Events
// ============================================================================

// 服务订单已完成
message ServiceOrderCompletedEvent {
  string order_number = 1;
  string technician_id = 2;
}

// 保修索赔提交
message WarrantyClaimFiledEvent {
  string claim_number = 1;
}

// 服务合同计费已生成
message ContractBilledEvent {
  string contract_number = 1;
  common.v1.MonetaryValue amount = 2;
}

// ============================================================================
// 10. IAM Events
// ============================================================================

// 用户登录事件
message UserLoginEvent {
  string user_id = 1;
  string ip_address = 2;
  google.protobuf.Timestamp login_time = 3;
}


