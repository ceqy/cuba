// ============================================================================
// /manufacturing/quality-inspection-service (版本 2.0)
// 描述: 提供质量检验批的创建、结果记录和使用决策功能。
//       字段设计参考核心ERP的 QALS (检验批记录) 和 QAMR (检验结果) 表。
// ============================================================================

syntax = "proto3";

package enterprise.manufacturing.quality;

option java_package = "com.enterprise.manufacturing.quality.v2";
option java_multiple_files = true;
option go_package = "github.com/enterprise-extensions/manufacturing/quality/v2;quality";

import "google/protobuf/timestamp.proto";
import "common/common.proto";

// ============================================================================
// 服务定义: QualityInspectionService
// ============================================================================

service QualityInspectionService {
  // 获取检验批详情
  rpc GetInspectionLot(GetInspectionLotRequest) returns (InspectionLotDetail);

  // 记录检验结果
  rpc RecordInspectionResults(RecordResultsRequest) returns (RecordResultsResponse);

  // 对检验批做使用决策
  rpc MakeUsageDecision(MakeUsageDecisionRequest) returns (MakeUsageDecisionResponse);
}

// ============================================================================
// 数据结构: InspectionLot (检验批)
// ============================================================================

// 检验批详情 (参考: QALS)
message InspectionLotDetail {
  // 检验批号 (原: PRUEFLOS)
  string inspection_lot_number = 1;
  // 物料编号 (原: MATNR)
  string material = 2;
  // 工厂 (原: WERK)
  string plant = 3;
  // 检验批来源 (例如, '01' for GR, '04' for Production) (原: HERKUNFT)
  string lot_origin = 4;
  // 检验批数量 (原: LOSMENGE)
  string lot_quantity = 5;
  // 单位
  string unit = 6;
  // 创建日期 (原: ENTSTEHDAT)
  google.protobuf.Timestamp creation_date = 7;
  // 检验特性列表
  repeated InspectionCharacteristic characteristics = 8;
}

// 检验特性 (参考: QAMR, QASR)
message InspectionCharacteristic {
  // 特性编号 (原: MERKNR)
  string characteristic_number = 1;
  // 特性描述
  string description = 2;
  // 检验方法
  string inspection_method = 3;
  // 记录的检验结果
  string result_value = 4;
  // 结果状态 (例如, '2' for Processed, '5' for Valuated)
  string result_status = 5;
}

// ============================================================================
// RPC 消息定义
// ============================================================================

// 获取检验批请求
message GetInspectionLotRequest {
  // 检验批号
  string inspection_lot_number = 1;
}

// 记录检验结果请求
message RecordResultsRequest {
  // 检验批号
  string inspection_lot_number = 1;
  // 结果列表
  repeated CharacteristicResult results = 2;
}

// 特性结果
message CharacteristicResult {
  // 特性编号
  string characteristic_number = 1;
  // 记录的值
  string value = 2;
}

// 记录检验结果响应
message RecordResultsResponse {
  // 操作是否成功
  bool success = 1;
  // 从核心ERP返回的消息列表
  repeated enterprise.common.ApiMessage messages = 2;
}

// 做使用决策请求
message MakeUsageDecisionRequest {
  // 检验批号
  string inspection_lot_number = 1;
  // 使用决策代码 (例如, 'A' for Accept, 'R' for Reject)
  string decision_code = 2;
  // 将合格品过账到的库存类型
  string post_to_stock_type = 3;
}

// 做使用决策响应
message MakeUsageDecisionResponse {
  // 操作是否成功
  bool success = 1;
  // 从核心ERP返回的消息列表
  repeated enterprise.common.ApiMessage messages = 2;
}
