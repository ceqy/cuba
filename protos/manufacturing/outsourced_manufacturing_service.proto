// ============================================================================
// /manufacturing/outsourced-manufacturing-service (版本 2.0)
// 描述: 管理外协加工流程，包括向供应商发料和接收加工后的成品。
//       这通常涉及特殊的采购订单项目类别和库存管理移动类型。
// ============================================================================

syntax = "proto3";

package enterprise.manufacturing.outsourced;

option java_package = "com.enterprise.manufacturing.outsourced.v2";
option java_multiple_files = true;
option go_package = "github.com/enterprise-extensions/manufacturing/outsourced/v2;outsourced";

import "google/protobuf/timestamp.proto";
import "common/common.proto";

// ============================================================================
// 服务定义: OutsourcedManufacturingService
// ============================================================================

service OutsourcedManufacturingService {
  // 获取外协采购订单详情
  rpc GetSubcontractingOrder(GetSubcontractingOrderRequest) returns (SubcontractingOrderDetail);

  // 向供应商过账组件发料
  rpc PostComponentsToSupplier(PostComponentsRequest) returns (PostComponentsResponse);

  // 接收外协加工成品
  rpc ReceiveFinishedGoodsFromSupplier(ReceiveFinishedGoodsRequest) returns (ReceiveFinishedGoodsResponse);
}

// ============================================================================
// 数据结构: Subcontracting (外协)
// ============================================================================

// 外协采购订单详情
message SubcontractingOrderDetail {
  // 采购订单号
  string purchase_order_number = 1;
  // 供应商
  string supplier = 2;
  // 外协成品项目列表
  repeated SubcontractingItem finished_goods_items = 3;
}

// 外协项目 (成品)
message SubcontractingItem {
  // 采购订单项目号
  int32 item_number = 1;
  // 成品物料编号
  string finished_good_material = 2;
  // 订单数量
  string order_quantity = 3;
  // 已收货数量
  string received_quantity = 4;
  // 单位
  string unit = 5;
  // 需要提供的组件列表
  repeated SubcontractingComponent components = 6;
}

// 外协组件
message SubcontractingComponent {
  // 组件物料编号
  string component_material = 1;
  // 需求数量
  string required_quantity = 2;
  // 已发货数量
  string issued_quantity = 3;
  // 单位
  string unit = 4;
}

// ============================================================================
// RPC 消息定义
// ============================================================================

// 获取外协订单请求
message GetSubcontractingOrderRequest {
  // 采购订单号
  string purchase_order_number = 1;
}

// 发送组件请求
message PostComponentsRequest {
  // 采购订单号
  string purchase_order_number = 1;
  // 过账日期
  google.protobuf.Timestamp posting_date = 2;
  // 要发送的组件列表
  repeated ComponentIssuance items = 3;
}

// 待发货的组件
message ComponentIssuance {
  // 采购订单项目号
  int32 purchase_order_item = 1;
  // 组件物料编号
  string component_material = 2;
  // 发货数量
  string quantity_to_issue = 3;
  // 单位
  string unit = 4;
}

// 发送组件响应
message PostComponentsResponse {
  // 生成的物料凭证号
  string material_document_number = 1;
  // 从核心ERP返回的消息列表
  repeated enterprise.common.ApiMessage messages = 2;
}

// 接收成品请求
message ReceiveFinishedGoodsRequest {
  // 采购订单号
  string purchase_order_number = 1;
  // 过账日期
  google.protobuf.Timestamp posting_date = 2;
  // 要接收的成品列表
  repeated FinishedGoodReceipt items = 3;
}

// 待接收的成品
message FinishedGoodReceipt {
  // 采购订单项目号
  int32 purchase_order_item = 1;
  // 接收数量
  string quantity_to_receive = 2;
  // 单位
  string unit = 3;
}

// 接收成品响应
message ReceiveFinishedGoodsResponse {
  // 生成的物料凭证号
  string material_document_number = 1;
  // 从核心ERP返回的消息列表
  repeated enterprise.common.ApiMessage messages = 2;
}
