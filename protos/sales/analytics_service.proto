// ============================================================================
// /sales/analytics-service (版本 2.0)
// 描述: 提供销售数据的多维度分析功能。
//       数据源于销售订单、交货单和发票，通常在数据仓库或分析平台中进行聚合。
// ============================================================================

syntax = "proto3";

package enterprise.sales.analytics;

option java_package = "com.enterprise.sales.analytics.v2";
option java_multiple_files = true;
option go_package = "github.com/enterprise-extensions/sales/analytics/v2;analytics";

import "common/common.proto";

// ============================================================================
// 服务定义: SalesAnalyticsService
// ============================================================================

service SalesAnalyticsService {
  // 按客户获取销售额
  rpc GetSalesByCustomer(SalesAnalysisRequest) returns (SalesAnalysisResponse);

  // 按产品获取销售额
  rpc GetSalesByProduct(SalesAnalysisRequest) returns (SalesAnalysisResponse);

  // 获取销售额趋势
  rpc GetSalesTrend(SalesTrendRequest) returns (SalesTrendResponse);
  
  // 导出销售报表 - 异步
  rpc ExportSalesReport(ExportSalesReportRequest) returns (enterprise.common.JobInfo);
}

// ============================================================================
// 数据结构: SalesAnalysis (销售分析)
// ============================================================================

// 销售分析维度
message SalesDimension {
  string id = 1; // 维度ID (例如, 客户ID或产品ID)
  string name = 2;
  enterprise.common.MonetaryValue revenue = 3;
  string quantity_sold = 4;
  string unit = 5;
}

// 时间序列数据点
message TimeSeriesDataPoint {
  string period = 1;
  enterprise.common.MonetaryValue revenue = 2;
}

// ============================================================================
// RPC 消息定义
// ============================================================================

// 销售分析请求
message SalesAnalysisRequest {
  enterprise.common.DateRange time_range = 1;
  repeated string sales_orgs = 2;
  repeated string distribution_channels = 3;
  int32 top_n = 4;
  enterprise.common.RequestContext context = 99;
}

// 销售分析响应
message SalesAnalysisResponse {
  repeated SalesDimension results = 1;
}

// 销售趋势请求
message SalesTrendRequest {
  enterprise.common.DateRange time_range = 1;
  enterprise.common.TimeGranularity granularity = 2;
  SalesAnalysisRequest filters = 3;
  enterprise.common.RequestContext context = 99;
}

// 销售趋势响应
message SalesTrendResponse {
  repeated TimeSeriesDataPoint trend = 1;
}

message ExportSalesReportRequest {
  enterprise.common.DateRange time_range = 1;
  repeated string sales_orgs = 2;
  enterprise.common.ReportType report_type = 3;
  string export_format = 4; // e.g. CSV, PDF
  enterprise.common.RequestContext context = 99;
}
