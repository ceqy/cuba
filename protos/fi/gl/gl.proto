// ============================================================================
// /finance/gl-journal-entry-service (版本 3.5 - 终极生产级完整版)
// 描述: 总账日记账管理服务，核心对接 SAP ACDOCA / BSEG 逻辑。
//       支持：创建、批量、冲销、模拟、过账、挂账、重复凭证、清账建议、
//       税务计算、外币重估、期末结转、批量输入会话、并行会计、字段拆分、
//       打印预览、附件、多级审批、审计追踪、高级分析、流式查询等。
// ----------------------------------------------------------------------------
// 设计基线：
// - 符合 SAP S/4HANA Universal Journal 架构
// - 严格遵循 BAPI_ACC_DOCUMENT_POST 的接口规范
// - 金额、数量等关键字段均采用字符串（防丢精）+ 币种/单位
// ============================================================================

syntax = "proto3";

package fi.gl.v1;

option go_package = "github.com/enterprise/erp/protos/fi/gl;gl";

import "google/protobuf/timestamp.proto";
import "google/api/annotations.proto";
import "protoc-gen-openapiv2/options/annotations.proto";
import "common/common.proto";

// OpenAPI 全局配置
option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_swagger) = {
  info: {
    title: "General Ledger Journal Entry Service API"
    version: "0.1.0"
    description: "总账日记账管理服务 - 提供财务凭证创建、过账、冲销、审批及高级财务分析功能"
    contact: {
      name: "GL Team"
      email: "gl@"
    }
  }
  host: "localhost:8080"
  base_path: "/"
  schemes: HTTP
  schemes: HTTPS
  consumes: "application/json"
  produces: "application/json"
  security_definitions: {
    security: {
      key: "bearer_auth"
      value: {
        type: TYPE_API_KEY
        in: IN_HEADER
        name: "Authorization"
        description: "Bearer token for authentication"
      }
    }
  }
  security: {
    security_requirement: {
      key: "bearer_auth"
      value: {}
    }
  }
  tags: {
    name: "Journal Entry Basics"
    description: "日记账基础操作 - 创建、查询、冲销凭证"
  }
  tags: {
    name: "Journal Entry Advanced"
    description: "日记账高级功能 - 清账建议、税计算、外币重估、期末处理"
  }
  tags: {
    name: "Batch Operations"
    description: "批量操作 - 批量过账、批量输入会话"
  }
  tags: {
    name: "Bank Statement"
    description: "银行对账单 - 导入、匹配、过账"
  }
  tags: {
    name: "Payment Run"
    description: "付款执行 - 自动付款、付款建议"
  }
};

// ============================================================================
// 服务定义: GlJournalEntryService
// ============================================================================

service GlJournalEntryService {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_tag) = {
    description: "总账日记账管理服务"
    external_docs: {
      url: "";
      description: "GL 服务详细文档";
    }
  };

  // --------------------------------------------------------------------------
  // === 基础凭证操作 ===
  // --------------------------------------------------------------------------

  // 创建凭证（草稿或立即过账）
  rpc CreateJournalEntry(CreateJournalEntryRequest) returns (JournalEntryResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/journal-entries"
      body: "*"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Journal Entry Basics"
      summary: "创建日记账凭证"
    };
  }

  // 获取凭证详情
  rpc GetJournalEntry(GetJournalEntryRequest) returns (JournalEntryDetail) {
    option (google.api.http) = {
      get: "/api/v1/finance/gl/journal-entries/{journal_entry_id}"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Journal Entry Basics"
      summary: "获取凭证详情"
    };
  }

  // 冲销凭证（Full Reversal）
  rpc ReverseJournalEntry(ReverseJournalEntryRequest) returns (JournalEntryResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/journal-entries/{journal_entry_id}/reverse"
      body: "*"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Journal Entry Basics"
      summary: "冲销凭证"
    };
  }

  // 查询凭证列表
  rpc ListJournalEntries(ListJournalEntriesRequest) returns (ListJournalEntriesResponse) {
    option (google.api.http) = {
      get: "/api/v1/finance/gl/journal-entries"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Journal Entry Basics"
      summary: "查询凭证列表"
    };
  }

  // 流式查询凭证 (New)
  rpc StreamJournalEntries(ListJournalEntriesRequest) returns (stream JournalEntryDetail) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/journal-entries:stream"
      body: "*"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Journal Entry Advanced"
      summary: "流式查询凭证"
    };
  }

  // --------------------------------------------------------------------------
  // === 批量操作 ===
  // --------------------------------------------------------------------------

  // 批量创建凭证
  rpc BatchCreateJournalEntries(BatchCreateJournalEntriesRequest) returns (BatchCreateJournalEntriesResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/journal-entries:batchCreate"
      body: "*"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      tags: "Batch Operations"
      summary: "批量创建凭证"
    };
  }

  // 批量冲销凭证
  rpc BatchReverseJournalEntries(BatchReverseJournalEntriesRequest) returns (BatchReverseJournalEntriesResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/journal-entries:batchReverse"
      body: "*"
    };
  }

  // --------------------------------------------------------------------------
  // === 更新与管理 ===
  // --------------------------------------------------------------------------

  // 更新凭证（仅限未过账部分字段）
  rpc UpdateJournalEntry(UpdateJournalEntryRequest) returns (JournalEntryResponse) {
    option (google.api.http) = {
      put: "/api/v1/finance/gl/journal-entries/{journal_entry_id}"
      body: "*"
    };
  }

  // 删除凭证（仅限草稿）
  rpc DeleteJournalEntry(DeleteJournalEntryRequest) returns (JournalEntryResponse) {
    option (google.api.http) = {
      delete: "/api/v1/finance/gl/journal-entries/{journal_entry_id}"
    };
  }

  // 过账凭证（Post Draft）
  rpc PostJournalEntry(PostJournalEntryRequest) returns (JournalEntryResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/journal-entries/{journal_entry_id}/post"
      body: "*"
    };
  }

  // --------------------------------------------------------------------------
  // === 财务高级功能 ===
  // --------------------------------------------------------------------------

  // 验证凭证合法性
  rpc ValidateJournalEntry(ValidateJournalEntryRequest) returns (ValidationResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/journal-entries/validate"
      body: "*"
    };
  }

  // 模拟过账效果
  rpc SimulateJournalEntry(SimulateJournalEntryRequest) returns (SimulationResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/journal-entries/simulate"
      body: "*"
    };
  }

  // 挂账执行（Document Parking）
  rpc ParkJournalEntry(ParkJournalEntryRequest) returns (ParkJournalEntryResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/journal-entries/park"
      body: "*"
    };
  }

  // 清账未清项目（Clearing Open Items）
  rpc ClearOpenItems(ClearOpenItemsRequest) returns (ClearOpenItemsResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/clearing"
      body: "*"
    };
  }

  // 获取外币重估建议
  rpc RevaluateForeignCurrency(RevaluateForeignCurrencyRequest) returns (RevaluationResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/revaluation"
      body: "*"
    };
  }

  // 并行会计分类账查询
  rpc GetParallelLedgerData(GetParallelLedgerDataRequest) returns (ParallelLedgerDataResponse) {
    option (google.api.http) = {
      get: "/api/v1/finance/gl/journal-entries/{document_reference.document_number}/parallels"
    };
  }

  // --------------------------------------------------------------------------
  // === 期末处理 ===
  // --------------------------------------------------------------------------

  // 执行期间结转
  rpc CarryForwardBalances(CarryForwardBalancesRequest) returns (CarryForwardBalancesResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/carry-forward"
      body: "*"
    };
  }

  // 执行期末关账
  rpc ExecutePeriodEndClose(ExecutePeriodEndCloseRequest) returns (PeriodEndCloseResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/period-end-close"
      body: "*"
    };
  }

  // --------------------------------------------------------------------------
  // === 系统集成与报表 ===
  // --------------------------------------------------------------------------

  // 创建批量输入会话 (Batch Input Session LSMW)
  rpc CreateBatchInputSession(CreateBatchInputSessionRequest) returns (BatchInputSessionResponse) {
    option (google.api.http) = {
      post: "/api/v1/finance/gl/batch-input"
      body: "*"
    };
  }

  // 获取科目余额明细 (Analytical Request)
  rpc GetAccountLineItems(GetAccountLineItemsRequest) returns (AccountLineItemsResponse) {
    option (google.api.http) = {
      get: "/api/v1/finance/gl/accounts/{gl_account}/line-items"
    };
  }

  // 生成打印预览
  rpc GeneratePrintPreview(GeneratePrintPreviewRequest) returns (GeneratePrintPreviewResponse) {
    option (google.api.http) = {
      get: "/api/v1/finance/gl/journal-entries/{document_reference.document_number}/preview"
    };
  }
}

// ============================================================================
// 数据结构: 枚举定义 (Enums)
// ============================================================================

// 凭证状态
enum JournalEntryStatus {
  JOURNAL_ENTRY_STATUS_UNSPECIFIED = 0;
  JOURNAL_ENTRY_STATUS_DRAFT = 1;       // 草稿 (Parked)
  JOURNAL_ENTRY_STATUS_PENDING = 2;     // 待审批
  JOURNAL_ENTRY_STATUS_REJECTED = 3;    // 已驳回
  JOURNAL_ENTRY_STATUS_POSTED = 4;      // 已过账 (Posted)
  JOURNAL_ENTRY_STATUS_REVERSED = 5;    // 已冲销
  JOURNAL_ENTRY_STATUS_CLEARED = 6;     // 已清账
  JOURNAL_ENTRY_STATUS_CANCELLED = 7;   // 已取消
}

// 冲销类型
enum ReversalType {
  REVERSAL_TYPE_UNSPECIFIED = 0;
  REVERSAL_TYPE_NORMAL = 1;             // 普通冲销 (同向借贷)
  REVERSAL_TYPE_NEGATIVE = 2;           // 负数冲销 (红字冲销)
}

// 导出与分析格式
enum ExportFormat {
  EXPORT_FORMAT_UNSPECIFIED = 0;
  EXPORT_FORMAT_PDF = 1;
  EXPORT_FORMAT_EXCEL = 2;
  EXPORT_FORMAT_CSV = 3;
  EXPORT_FORMAT_HTML = 4;
}

// 支付状态
enum PaymentStatus {
  PAYMENT_STATUS_UNSPECIFIED = 0;
  PAYMENT_STATUS_OPEN = 1;              // 未支付
  PAYMENT_STATUS_IN_PROGRESS = 2;       // 支付中
  PAYMENT_STATUS_PAID = 3;              // 已支付
  PAYMENT_STATUS_REJECTED = 4;          // 支付失败
}

// 清账状态
enum ClearingStatus {
  CLEARING_STATUS_UNSPECIFIED = 0;
  CLEARING_STATUS_OPEN = 1;              // 未清项
  CLEARING_STATUS_CLEARED = 2;           // 已清项
  CLEARING_STATUS_PARTIAL = 3;           // 部分清项
}

// 分类账类型
enum LedgerType {
  LEDGER_TYPE_UNSPECIFIED = 0;
  LEDGER_TYPE_LEADING = 1;              // 主分类账 (0L)
  LEDGER_TYPE_NON_LEADING = 2;          // 非主分类账 (如 1L, 2L)
  LEDGER_TYPE_EXTENSION = 3;            // 扩展分类账
}

// 期间状态
enum PeriodStatus {
  PERIOD_STATUS_UNSPECIFIED = 0;
  PERIOD_STATUS_OPEN = 1;               // 期间打开
  PERIOD_STATUS_CLOSED = 2;             // 期间关闭
  PERIOD_STATUS_LOCKED = 3;             // 期间锁定
}

// 凭证来源
enum DocumentOrigin {
  DOCUMENT_ORIGIN_UNSPECIFIED = 0;
  DOCUMENT_ORIGIN_MANUAL = 1;           // 手工输入
  DOCUMENT_ORIGIN_API = 2;              // API 自动创建
  DOCUMENT_ORIGIN_SD = 3;               // 销售集成
  DOCUMENT_ORIGIN_MM = 4;               // 采购集成
  DOCUMENT_ORIGIN_CO = 5;               // 成本分配集成
  DOCUMENT_ORIGIN_FX = 6;               // 汇兑差异
}

// 特殊总账类型 (Special G/L Type / UMSKZ)
// 用于区分特殊业务类型，影响应收/应付账款分类、报表列示和清账逻辑
enum SpecialGlType {
  SPECIAL_GL_TYPE_UNSPECIFIED = 0;
  SPECIAL_GL_TYPE_NORMAL = 1;           // 普通业务（无特殊标识）
  SPECIAL_GL_TYPE_BILL_OF_EXCHANGE = 2; // A - 票据 (Bills of Exchange)
  SPECIAL_GL_TYPE_DOWN_PAYMENT = 3;     // F - 预付款 (Down Payment)
  SPECIAL_GL_TYPE_ADVANCE_PAYMENT = 4;  // V - 预收款 (Advance Payment)
  SPECIAL_GL_TYPE_BILL_DISCOUNT = 5;    // W - 票据贴现 (Bill of Exchange Discount)
}

// ============================================================================
// 数据结构: 核心凭证模型
// ============================================================================

// 凭证抬头 (类似 SAP BKPF 表)
message JournalEntryHeader {
  string company_code = 1;             // 公司代码 (BUKRS)
  string document_type = 2;            // 凭证类型 (BLART)
  google.protobuf.Timestamp document_date = 3; // 凭证日期 (BLDAT)
  google.protobuf.Timestamp posting_date = 4;  // 过账日期 (BUDAT)
  int32 fiscal_year = 5;               // 会计年度 (GJAHR)
  int32 fiscal_period = 6;             // 会计期间 (MONAT)
  string currency = 7;                 // 货币代码 (WAERS)
  string exchange_rate = 8;            // 汇率 (KURSF)
  string reference_document = 9;       // 参考凭证号 (XBLNR)
  string header_text = 10;             // 凭证抬头文本 (BKTXT)
  DocumentOrigin origin = 11;          // 来源系统
  string logical_system = 12;          // 逻辑系统 (AWSYS)
  string ledger_group = 13;            // 分类账组 (LDGRP)
  string default_ledger = 14;          // 默认分类账 (RLDNR: 0L, 1L, 2L...) - 用于并行会计
  common.v1.AuditData audit = 15;

  // ============================================================================
  // 多币种支持字段 (Multi-Currency Support)
  // ============================================================================
  // 用于多币种报表和集团合并
  // SAP 字段映射:
  //   - local_currency: RHCUR (本位币/记账本位币)
  //   - group_currency: RKCUR (集团货币/合并货币)
  //   - target_currency: RTCUR (目标货币/报表货币)
  // 影响:
  //   - 多币种财务报表编制
  //   - 集团合并报表（使用集团货币）
  //   - 管理报表（使用目标货币）
  string local_currency = 20;          // 本位币 (RHCUR) - 公司记账本位币
  string group_currency = 21;          // 集团货币 (RKCUR) - 用于集团合并
  string target_currency = 22;         // 目标货币 (RTCUR) - 用于管理报表

  // ============================================================================
  // 科目表字段 (Chart of Accounts)
  // ============================================================================
  // 用于多科目表场景和科目管理
  // SAP 字段映射:
  //   - chart_of_accounts: KTOPL (科目表)
  // 影响:
  //   - 支持多科目表场景（集团科目表、国家科目表、运营科目表）
  //   - 科目主数据管理
  //   - 跨公司代码的科目映射
  // 使用场景:
  //   - 集团公司使用统一的集团科目表
  //   - 不同国家/地区使用不同的国家科目表
  //   - 运营科目表用于日常业务
  string chart_of_accounts = 23;      // 科目表 (KTOPL) - 用于多科目表场景
}

// 凭证行项目 (类似 SAP ACDOCA / BSEG 表)
message JournalEntryLineItem {
  int32 line_item_number = 1;          // 行号 (BUZEI)
  string posting_key = 2;              // 过账码 (BSCHL)
  string debit_credit_indicator = 3;   // 借贷标识 (SHKZG: S=Debit, H=Credit)
  string gl_account = 4;               // 总账科目 (HKONT)
  common.v1.AccountType account_type = 5; // 账户类型 (KOART)
  string business_partner = 6;         // 业务伙伴 (KUNNR/LIFNR)
  
  // 金额相关
  common.v1.MonetaryValue amount_in_local_currency = 7;
  common.v1.MonetaryValue amount_in_document_currency = 8;
  common.v1.MonetaryValue amount_in_group_currency = 9;
  
  // 成本对象
  string cost_center = 10;             // 成本中心 (KOSTL)
  string profit_center = 11;           // 利润中心 (PRCTR)
  string segment = 12;                 // 段 (SEGMENT)
  string internal_order = 13;          // 内部订单 (AUFNR)
  string wbs_element = 14;             // WBS 元素 (PS_PSP_PNR)
  
  // 文本与参考
  string text = 15;                    // 条目文本 (SGTXT)
  string assignment_number = 16;       // 指派编号 (ZUONR)
  
  // 税务
  string tax_code = 17;                // 税码 (MWSKZ)
  string tax_jurisdiction = 18;        // 税收辖区 (TXJCD)
  
  // 清帐信息
  string clearing_document = 19;       // 清帐凭证 (AUGBL)
  google.protobuf.Timestamp clearing_date = 20;

  // 数量
  common.v1.QuantityValue quantity = 21;

  // ============================================================================
  // 特殊总账标识 (Special G/L Indicator / UMSKZ)
  // ============================================================================
  // 用于区分特殊业务类型（票据、预付款、预收款等）
  // 常见值:
  //   - 空值 = 普通业务
  //   - A = 票据 (Bills of Exchange)
  //   - F = 预付款 (Down Payment)
  //   - V = 预收款 (Advance Payment)
  //   - W = 票据贴现 (Bill of Exchange Discount)
  // 影响:
  //   - 应收/应付账款的分类管理
  //   - 财务报表的准确性（预付款需要单独列示）
  //   - 清账逻辑（特殊总账项目的清账规则不同）
  string special_gl_indicator = 22;    // 特殊总账标识 (UMSKZ)

  // ============================================================================
  // 并行会计字段 (Parallel Accounting / RLDNR)
  // ============================================================================
  string ledger = 50;                      // 分类账编号 (RLDNR: 0L, 1L, 2L...)
  LedgerType ledger_type = 51;             // 分类账类型（主账/非主账/扩展账）
  common.v1.MonetaryValue amount_in_ledger_currency = 52; // 分类账货币金额（用于不同会计准则下的金额差异）

  // ============================================================================
  // 付款条件详细字段 (Payment Terms Detail)
  // ============================================================================
  // 用于精确计算现金折扣和到期日
  // SAP 字段映射:
  //   - baseline_date: ZFBDT (现金折扣基准日)
  //   - discount_days_1: ZBD1T (第一个折扣天数)
  //   - discount_days_2: ZBD2T (第二个折扣天数)
  //   - net_payment_days: ZBD3T (净付款天数)
  //   - discount_percent_1: ZBD1P (第一个折扣百分比)
  //   - discount_percent_2: ZBD2P (第二个折扣百分比)
  //   - discount_amount: SKFBT (现金折扣金额)
  // 影响:
  //   - 精确计算现金折扣金额
  //   - 准确确定付款到期日
  //   - 支持多级折扣（如 2/10 net 30）
  PaymentTermsDetail payment_terms_detail = 53;

  // ============================================================================
  // 组织维度字段 (Organizational Dimensions)
  // ============================================================================
  // 用于合并报表、段报告和管理会计
  // SAP 字段映射:
  //   - financial_area: RFAREA (财务范围)
  //   - business_area: RBUSA (业务范围)
  //   - controlling_area: KOKRS (控制范围)
  // 影响:
  //   - 合并报表编制（财务范围用于集团合并）
  //   - 段报告和业务分析（业务范围用于业务线报告）
  //   - 管理会计和成本控制（控制范围用于成本中心核算）
  string financial_area = 54;              // 财务范围 (RFAREA) - 用于合并报表
  string business_area = 55;               // 业务范围 (RBUSA) - 用于段报告
  string controlling_area = 56;            // 控制范围 (KOKRS) - 用于管理会计

  // ============================================================================
  // 多币种金额字段 (Multi-Currency Amounts)
  // ============================================================================
  // 用于多币种报表和不同维度的金额核算
  // SAP 字段映射:
  //   - amount_in_object_currency: OSL (对象货币金额)
  //   - amount_in_profit_center_currency: VSL (利润中心货币金额)
  // 影响:
  //   - 成本对象核算（使用对象货币）
  //   - 利润中心报表（使用利润中心货币）
  //   - 多维度财务分析
  common.v1.MonetaryValue amount_in_object_currency = 62;        // 对象货币金额 (OSL)
  common.v1.MonetaryValue amount_in_profit_center_currency = 63; // 利润中心货币金额 (VSL)

  // ============================================================================
  // 发票参考字段 (Invoice Reference / REBZG)
  // ============================================================================
  // 用于贷项凭证（Credit Memo）追溯原始发票
  // 场景：
  //   - 销售退货：需要引用原始销售发票
  //   - 采购退货：需要引用原始采购发票
  //   - 价格调整：需要引用原始发票进行调整
  // 影响：
  //   - 审计追踪：可以追溯到原始交易
  //   - 财务报表：正确反映退货和调整
  //   - 清账逻辑：贷项凭证与原始发票的关联清账
  InvoiceReference invoice_reference = 57;  // 发票参考信息

  // ============================================================================
  // 催款相关字段 (Dunning Detail / MSCHL)
  // ============================================================================
  // 用于应收/应付账款的催款管理
  // 场景：
  //   - 客户逾期付款：自动生成催款函
  //   - 多级催款：根据逾期天数升级催款级别
  //   - 催款冻结：临时停止催款（如客户有争议）
  // 影响：
  //   - 现金流管理：及时催收逾期款项
  //   - 客户关系：合理的催款策略
  //   - 坏账控制：早期识别风险客户
  DunningDetail dunning_detail = 58;  // 催款详细信息

  // =============================================================================
  // 业务交易类型字段 (Transaction Type / VRGNG)
  // =============================================================================
  // 用于区分不同业务场景，影响报表分类、业务流程和数据分析
  // 场景：
  //   - 销售业务：销售发票、销售退货、销售折扣
  //   - 采购业务：采购发票、采购退货、采购折扣
  //   - 资产业务：资产购置、资产处置、资产折旧
  //   - 财务业务：银行转账、现金支付、汇兑损益
  // 影响：
  //   - 业务分类：按业务类型分类统计
  //   - 报表列示：不同业务类型在报表中的展示
  //   - 审计追踪：追溯业务来源和类型
  //   - 集成对账：与源系统（SD/MM/AA）对账
  string transaction_type = 59;           // VRGNG 业务交易类型（如：RV-销售发票、WE-采购收货）
  string reference_transaction_type = 60; // AWTYP 参考交易类型（源系统类型：VBRK-销售、MKPF-物料凭证）
  string trading_partner_company = 61;    // VBUND 交易伙伴公司代码（集团内部交易）

  // ============================================================================
  // 科目分配字段 (Account Assignment / KTOSL)
  // ============================================================================
  // 用于自动科目确定和科目分配
  // SAP 字段映射:
  //   - account_assignment: KTOSL (科目分配)
  // 影响:
  //   - 自动科目确定：根据业务交易类型自动确定科目
  //   - 科目分配规则：定义不同业务场景的科目分配逻辑
  //   - 配置灵活性：支持不同公司代码、业务类型的科目配置
  // 使用场景:
  //   - 存货科目确定（GBB-存货、AUM-存货差异）
  //   - 收入科目确定（ERL-收入、ERU-折扣）
  //   - 费用科目确定（AUF-费用、FRL-运费）
  //   - 税务科目确定（MWS-进项税、VST-销项税）
  //   - 汇兑损益科目（KDM-汇兑损失、KDF-汇兑收益）
  string account_assignment = 64;         // KTOSL 科目分配（自动科目确定）

  // ============================================================================
  // 付款执行字段 (Payment Execution / ZLSCH)
  // ============================================================================
  // 用于自动付款程序和付款执行
  // 场景：
  //   - 应付账款：指定付款方式和银行账户
  //   - 自动付款：根据付款方式自动生成付款文件
  //   - 付款分组：按付款方式和银行分组处理
  // 影响：
  //   - 付款处理：自动付款程序根据这些字段生成付款
  //   - 银行对账：付款与银行账户的关联
  //   - 现金流管理：按付款方式统计和预测现金流
  PaymentExecutionDetail payment_execution = 65;  // 付款执行详细信息

  // ============================================================================
  // 内部交易字段 (Internal Trading Detail)
  // ============================================================================
  // 用于集团内部交易的成本中心和利润中心对冲
  // SAP 字段映射:
  //   - sending_cost_center: SCNTR (发送成本中心)
  //   - partner_profit_center: PPRCTR (伙伴利润中心)
  //   - sending_financial_area: SFAREA (发送财务范围)
  // 影响:
  //   - 内部交易对冲：自动生成对冲分录
  //   - 合并报表：内部交易抵消
  //   - 利润中心核算：准确核算各利润中心业绩
  InternalTradingDetail internal_trading_detail = 66;

  // ============================================================================
  // 字段拆分详细信息 (Field Split Detail)
  // ============================================================================
  // 用于支持字段拆分功能，将单个行项目拆分为多个维度
  // SAP 字段映射:
  //   - split_method: XSPLITMOD (拆分方法)
  //   - manual_split: MANSP (手工拆分标识)
  // 影响:
  //   - 成本分摊：按比例分摊到多个成本中心
  //   - 收入分配：按比例分配到多个利润中心
  //   - 灵活核算：支持复杂的维度分配场景
  FieldSplitDetail field_split_detail = 67;

  // ============================================================================
  // 本地 GAAP 字段 (Local GAAP Detail)
  // ============================================================================
  // 用于支持本地会计准则（如中国会计准则）
  // SAP 字段映射:
  //   - local_account: LOKKT (本地科目)
  //   - data_source: HRKFT (数据来源)
  // 影响:
  //   - 双轨制核算：同时满足 IFRS 和本地 GAAP
  //   - 本地报表：生成符合本地准则的财务报表
  //   - 税务申报：满足本地税务申报要求
  LocalGAAPDetail local_gaap_detail = 68;
}

// 发票参考信息（用于贷项凭证追溯原始发票）
message InvoiceReference {
  string reference_document_number = 1;  // 参考凭证号 (REBZG)
  int32 reference_fiscal_year = 2;       // 参考会计年度 (REBZJ)
  int32 reference_line_item = 3;         // 参考行项目号 (REBZZ)
  string reference_document_type = 4;    // 参考凭证类型 (REBZT)
  string reference_company_code = 5;     // 参考公司代码
}

// 付款条件详细信息（用于精确计算现金折扣和到期日）
message PaymentTermsDetail {
  google.protobuf.Timestamp baseline_date = 1;  // ZFBDT 现金折扣基准日
  int32 discount_days_1 = 2;                    // ZBD1T 第一个折扣天数
  int32 discount_days_2 = 3;                    // ZBD2T 第二个折扣天数
  int32 net_payment_days = 4;                   // ZBD3T 净付款天数
  string discount_percent_1 = 5;                // ZBD1P 第一个折扣百分比（使用字符串防精度丢失）
  string discount_percent_2 = 6;                // ZBD2P 第二个折扣百分比（使用字符串防精度丢失）
  common.v1.MonetaryValue discount_amount = 7;  // SKFBT 现金折扣金额
}

// 催款详细信息（用于应收/应付账款的催款管理）
message DunningDetail {
  string dunning_key = 1;                       // MSCHL 催款码（催款程序标识）
  string dunning_block = 2;                     // MANST 催款冻结（冻结原因代码）
  google.protobuf.Timestamp last_dunning_date = 3;  // MADAT 上次催款日期
  google.protobuf.Timestamp dunning_date = 4;   // MANDT 催款日期（下次催款日期）
  int32 dunning_level = 5;                      // 催款级别（1-9，级别越高越严厉）
  string dunning_area = 6;                      // MAHNA 催款范围（用于区分不同催款策略）
  int32 grace_period_days = 7;                  // 宽限期天数
  common.v1.MonetaryValue dunning_charges = 8;  // 催款费用（每次催款收取的费用）
  string dunning_clerk = 9;                     // 催款员（负责催款的人员）
}

// ============================================================================
// 付款执行详细信息 (Payment Execution Detail)
// ============================================================================
// 用于自动付款程序（Automatic Payment Program）和付款执行
// 场景：
//   - 自动付款：根据付款方式自动生成付款文件
//   - 银行集成：指定付款使用的银行账户
//   - 付款分组：按付款方式和银行分组处理
// 影响：
//   - 付款处理：自动付款程序根据这些字段生成付款
//   - 银行对账：付款与银行账户的关联
//   - 现金流管理：按付款方式统计和预测现金流
// SAP 字段映射:
//   - payment_method: ZLSCH (付款方式代码，如 T-转账、C-支票、W-电汇)
//   - house_bank: HBKID (内部银行账户标识)
//   - partner_bank_type: BVTYP (业务伙伴银行类型)
message PaymentExecutionDetail {
  string payment_method = 1;      // ZLSCH 付款方式（T-转账、C-支票、W-电汇、Z-其他）
  string house_bank = 2;          // HBKID 内部银行账户标识（公司银行账户）
  string partner_bank_type = 3;   // BVTYP 业务伙伴银行类型（用于区分不同银行账户）
  string payment_block = 4;       // ZLSPR 付款冻结（冻结原因代码，如 A-争议、B-审批中）
  google.protobuf.Timestamp payment_baseline_date = 5;  // ZFBDT 付款基准日（用于计算付款到期日）
  string payment_reference = 6;   // 付款参考号（用于银行对账）
  int32 payment_priority = 7;     // 付款优先级（1-9，数字越小优先级越高）
}

// ============================================================================
// 内部交易详细信息 (Internal Trading Detail)
// ============================================================================
// 用于集团内部交易的成本中心和利润中心对冲
// 场景：
//   - 集团内部销售：A 公司销售给 B 公司
//   - 成本中心对冲：发送成本中心和接收成本中心
//   - 利润中心对冲：发送利润中心和伙伴利润中心
// 影响：
//   - 内部交易对冲：自动生成对冲分录
//   - 合并报表：内部交易抵消
//   - 利润中心核算：准确核算各利润中心业绩
// SAP 字段映射:
//   - sending_cost_center: SCNTR (发送成本中心)
//   - partner_profit_center: PPRCTR (伙伴利润中心)
//   - sending_financial_area: SFAREA (发送财务范围)
message InternalTradingDetail {
  string sending_cost_center = 1;    // SCNTR 发送成本中心（内部交易发起方成本中心）
  string partner_profit_center = 2;  // PPRCTR 伙伴利润中心（内部交易对方利润中心）
  string sending_financial_area = 3; // SFAREA 发送财务范围（内部交易发起方财务范围）
}

// ============================================================================
// 字段拆分详细信息 (Field Split Detail)
// ============================================================================
// 用于支持字段拆分功能，将单个行项目拆分为多个维度
// 场景：
//   - 成本分摊：一笔费用按比例分摊到多个成本中心
//   - 收入分配：一笔收入按比例分配到多个利润中心
//   - 项目核算：一笔支出按比例分配到多个项目
// 影响：
//   - 成本分摊：按比例分摊到多个成本中心
//   - 收入分配：按比例分配到多个利润中心
//   - 灵活核算：支持复杂的维度分配场景
// SAP 字段映射:
//   - split_method: XSPLITMOD (拆分方法)
//   - manual_split: MANSP (手工拆分标识)
message FieldSplitDetail {
  string split_method = 1;  // XSPLITMOD 拆分方法（拆分规则代码）
  bool manual_split = 2;    // MANSP 手工拆分标识（true-手工拆分，false-自动拆分）
}

// ============================================================================
// 本地 GAAP 详细信息 (Local GAAP Detail)
// ============================================================================
// 用于支持本地会计准则（如中国会计准则）
// 场景：
//   - 双轨制核算：同时满足 IFRS 和本地 GAAP
//   - 本地报表：生成符合本地准则的财务报表
//   - 税务申报：满足本地税务申报要求
// 影响：
//   - 双轨制核算：同时满足 IFRS 和本地 GAAP
//   - 本地报表：生成符合本地准则的财务报表
//   - 税务申报：满足本地税务申报要求
// SAP 字段映射:
//   - local_account: LOKKT (本地科目)
//   - data_source: HRKFT (数据来源)
message LocalGAAPDetail {
  string local_account = 1;  // LOKKT 本地科目（本地会计准则科目）
  string data_source = 2;    // HRKFT 数据来源（数据来源标识）
}

// 凭证税行
message TaxLineItem {
  int32 line_item_number = 1;
  string tax_code = 2;
  common.v1.MonetaryValue tax_base_amount = 3;
  common.v1.MonetaryValue tax_amount = 4;
}

// 凭证详情 (聚合对象)
message JournalEntryDetail {
  JournalEntryHeader header = 1;
  repeated JournalEntryLineItem line_items = 2;
  repeated TaxLineItem tax_items = 3;
  JournalEntryStatus status = 4;
  common.v1.SystemDocumentReference document_reference = 5;
  ClearingInformation clearing_info = 6;
  PaymentInformation payment_info = 7;
  WorkflowInformation workflow_info = 8;
  repeated AttachmentInfo attachments = 9;
}

// ============================================================================
// RPC 消息定义
// ============================================================================

message CreateJournalEntryRequest {
  JournalEntryHeader header = 1;
  repeated JournalEntryLineItem line_items = 2;
  bool test_run = 3;
  bool post_immediately = 4;
  common.v1.RequestContext context = 99;
}

message JournalEntryResponse {
  bool success = 1;
  common.v1.SystemDocumentReference document_reference = 2;
  repeated common.v1.ApiMessage messages = 3;
}

message GetJournalEntryRequest {
  string journal_entry_id = 1;
  common.v1.SystemDocumentReference document_reference = 2;
  common.v1.RequestContext context = 99;
}

message ReverseJournalEntryRequest {
  string journal_entry_id = 1;
  common.v1.SystemDocumentReference document_to_reverse = 2;
  string reversal_reason = 3;
  google.protobuf.Timestamp posting_date = 4;
  ReversalType reversal_type = 5;
  common.v1.RequestContext context = 99;
}

message ListJournalEntriesRequest {
  string company_code = 1;
  int32 fiscal_year = 2;
  common.v1.DateRange posting_date_range = 3;
  string document_type = 4;
  string created_by = 5;
  repeated JournalEntryStatus status_filter = 6;
  string gl_account = 7;
  repeated string ledgers = 8;             // 按分类账过滤（支持并行会计查询）
  common.v1.PaginationRequest pagination = 98;
  common.v1.RequestContext context = 99;
}

message ListJournalEntriesResponse {
  repeated JournalEntrySummary entries = 1;
  common.v1.PaginationResponse pagination = 2;
}

message JournalEntrySummary {
  common.v1.SystemDocumentReference document_reference = 1;
  google.protobuf.Timestamp document_date = 2;
  google.protobuf.Timestamp posting_date = 3;
  string header_text = 4;
  JournalEntryStatus status = 5;
  common.v1.MonetaryValue total_amount = 6;
}

message BatchCreateJournalEntriesRequest {
  repeated CreateJournalEntryRequest entries = 1;
  bool test_run = 2;
  common.v1.RequestContext context = 99;
}

message BatchCreateJournalEntriesResponse {
  common.v1.BatchOperationResult result = 1;
  repeated JournalEntryResponse responses = 2;
}

message UpdateJournalEntryRequest {
  string journal_entry_id = 1;
  common.v1.SystemDocumentReference document_reference = 2;
  JournalEntryHeader header = 3;
  repeated string update_mask = 4;
  common.v1.RequestContext context = 99;
}

message DeleteJournalEntryRequest {
  string journal_entry_id = 1;
  common.v1.SystemDocumentReference document_reference = 2;
  common.v1.RequestContext context = 99;
}

message PostJournalEntryRequest {
  string journal_entry_id = 1;
  common.v1.SystemDocumentReference document_reference = 2;
  google.protobuf.Timestamp posting_date = 3;
  common.v1.RequestContext context = 99;
}

message ValidateJournalEntryRequest {
  JournalEntryHeader header = 1;
  repeated JournalEntryLineItem line_items = 2;
  common.v1.RequestContext context = 99;
}

message ValidationResponse {
  bool is_valid = 1;
  repeated common.v1.ApiMessage messages = 2;
}

message SimulateJournalEntryRequest {
  JournalEntryHeader header = 1;
  repeated JournalEntryLineItem line_items = 2;
  common.v1.RequestContext context = 99;
}

message SimulationResponse {
  bool success = 1;
  repeated common.v1.ApiMessage messages = 2;
  JournalEntryDetail simulated_entry = 3;
}

message ParkJournalEntryRequest {
  JournalEntryHeader header = 1;
  repeated JournalEntryLineItem line_items = 2;
  string parking_reason = 3;
  common.v1.RequestContext context = 99;
}

message ParkJournalEntryResponse {
  bool success = 1;
  common.v1.SystemDocumentReference parked_document_reference = 2;
  repeated common.v1.ApiMessage messages = 3;
}

message ClearOpenItemsRequest {
  string company_code = 1;
  common.v1.AccountType account_type = 2;
  string account_number = 3;
  repeated OpenItemToClear items_to_clear = 4;
  google.protobuf.Timestamp clearing_date = 5;
  common.v1.RequestContext context = 99;
}

message OpenItemToClear {
  common.v1.SystemDocumentReference document_reference = 1;
  int32 line_item_number = 2;
  common.v1.MonetaryValue clearing_amount = 3;
}

message ClearOpenItemsResponse {
  bool success = 1;
  common.v1.SystemDocumentReference clearing_document_reference = 2;
  repeated common.v1.ApiMessage messages = 3;
}

message GetParallelLedgerDataRequest {
  common.v1.SystemDocumentReference document_reference = 1;
  repeated string ledgers = 2;
  common.v1.RequestContext context = 99;
}

message ParallelLedgerDataResponse {
  common.v1.SystemDocumentReference document_reference = 1;
  repeated LedgerData ledger_data = 2;
}

message LedgerData {
  string ledger = 1;
  LedgerType ledger_type = 2;
  repeated JournalEntryLineItem line_items = 3;
}

message CarryForwardBalancesRequest {
  string company_code = 1;
  int32 source_fiscal_year = 2;
  int32 target_fiscal_year = 3;
  bool test_run = 4;
  common.v1.RequestContext context = 99;
}

message CarryForwardBalancesResponse {
  bool success = 1;
  repeated common.v1.ApiMessage messages = 2;
}

message ExecutePeriodEndCloseRequest {
  string company_code = 1;
  int32 fiscal_year = 2;
  int32 fiscal_period = 3;
  common.v1.RequestContext context = 99;
}

message PeriodEndCloseResponse {
  bool success = 1;
  PeriodStatus period_status = 2;
  repeated common.v1.ApiMessage messages = 3;
}

message CreateBatchInputSessionRequest {
  string session_name = 1;
  repeated CreateJournalEntryRequest entries = 2;
  common.v1.RequestContext context = 99;
}

message BatchInputSessionResponse {
  bool success = 1;
  string session_id = 2;
  repeated common.v1.ApiMessage messages = 3;
}

message GetAccountLineItemsRequest {
  string company_code = 1;
  string gl_account = 2;
  common.v1.DateRange date_range = 3;
  common.v1.PaginationRequest pagination = 98;
  common.v1.RequestContext context = 99;
}

message AccountLineItemsResponse {
  string gl_account = 1;
  repeated JournalEntryLineItem line_items = 2;
  common.v1.PaginationResponse pagination = 3;
}

message GeneratePrintPreviewRequest {
  common.v1.SystemDocumentReference document_reference = 1;
  ExportFormat format = 2;
  common.v1.RequestContext context = 99;
}

message GeneratePrintPreviewResponse {
  bool success = 1;
  bytes print_content = 2;
  string mime_type = 3;
  string file_name = 4;
}

// --- Supporting Messages ---

message ClearingInformation {
  string clearing_document = 1;
  google.protobuf.Timestamp clearing_date = 2;
  ClearingStatus status = 3;
  common.v1.MonetaryValue clearing_amount = 4;
}

message PaymentInformation {
  PaymentStatus status = 1;
  common.v1.PaymentMethodType method = 2;
  common.v1.MonetaryValue payment_amount = 3;
  google.protobuf.Timestamp payment_date = 4;
  string payment_reference = 5;
}

message AttachmentInfo {
  string attachment_id = 1;
  string file_name = 2;
  int64 file_size = 3;
  string mime_type = 4;
  google.protobuf.Timestamp uploaded_at = 5;
}

message WorkflowInformation {
  string workflow_instance_id = 1;
  string current_step = 2;
  string status = 3;
  repeated string pending_approvers = 4;
}

message BatchReverseJournalEntriesRequest {
  repeated ReverseJournalEntryRequest entries = 1;
  common.v1.RequestContext context = 99;
}

message BatchReverseJournalEntriesResponse {
  common.v1.BatchOperationResult result = 1;
  repeated JournalEntryResponse responses = 2;
}

message RevaluateForeignCurrencyRequest {
  string company_code = 1;
  google.protobuf.Timestamp revaluation_date = 2;
  bool test_run = 3;
  common.v1.RequestContext context = 99;
}

message RevaluationResponse {
  bool success = 1;
  common.v1.SystemDocumentReference document_reference = 2;
  repeated common.v1.ApiMessage messages = 3;
}
