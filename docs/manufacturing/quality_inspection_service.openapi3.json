{
  "openapi": "3.1.0",
  "info": {
    "title": "Quality Inspection Service API",
    "version": "version not set",
    "description": "质量检验服务 - 检验批次、质检结果、使用决策",
    "contact": {
      "name": "Quality Team",
      "email": "quality@enterprise.com"
    }
  },
  "tags": [
    {
      "name": "QualityInspectionService",
      "description": "QualityInspectionService"
    }
  ],
  "paths": {
    "/api/v1/manufacturing/inspection-lot": {
      "get": {
        "summary": "获取检验批详情",
        "operationId": "QualityInspectionService_GetInspectionLot",
        "responses": {
          "200": {
            "description": "A successful response.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/qualityInspectionLotDetail"
                }
              }
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/rpcStatus"
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "inspection_lot_number",
            "description": "检验批号",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.request_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.tenant_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.user_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.roles",
            "in": "query",
            "required": false,
            "explode": true,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          {
            "name": "context.idempotency_key",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.locale",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.timestamp",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "context.source_system",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.correlation_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "tags": [
          "QualityInspectionService"
        ]
      },
      "post": {
        "summary": "创建检验批 (New)",
        "operationId": "QualityInspectionService_CreateInspectionLot",
        "responses": {
          "200": {
            "description": "A successful response.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/qualityInspectionLotResponse"
                }
              }
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/rpcStatus"
                }
              }
            }
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/qualityCreateInspectionLotRequest"
              }
            }
          },
          "required": true
        },
        "tags": [
          "QualityInspectionService"
        ]
      }
    },
    "/api/v1/manufacturing/inspection-lots": {
      "get": {
        "summary": "查询检验批列表 (New)",
        "operationId": "QualityInspectionService_ListInspectionLots",
        "responses": {
          "200": {
            "description": "A successful response.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/qualityListInspectionLotsResponse"
                }
              }
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/rpcStatus"
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "plant",
            "description": "工厂",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "material",
            "description": "物料",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "origin",
            "description": "来源\n\n - INSPECTION_LOT_ORIGIN_GOODS_RECEIPT: 收货\n - INSPECTION_LOT_ORIGIN_PRODUCTION: 生产\n - INSPECTION_LOT_ORIGIN_SUB_CONTRACTING: 外协\n - INSPECTION_LOT_ORIGIN_STOCK_TRANSFER: 库存转移\n - INSPECTION_LOT_ORIGIN_CUSTOMER_RETURN: 客户退货",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "INSPECTION_LOT_ORIGIN_UNSPECIFIED",
                "INSPECTION_LOT_ORIGIN_GOODS_RECEIPT",
                "INSPECTION_LOT_ORIGIN_PRODUCTION",
                "INSPECTION_LOT_ORIGIN_SUB_CONTRACTING",
                "INSPECTION_LOT_ORIGIN_STOCK_TRANSFER",
                "INSPECTION_LOT_ORIGIN_CUSTOMER_RETURN"
              ],
              "default": "INSPECTION_LOT_ORIGIN_UNSPECIFIED"
            }
          },
          {
            "name": "creation_date_range.start_date",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "creation_date_range.end_date",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "pagination.page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32"
            }
          },
          {
            "name": "pagination.page_size",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32"
            }
          },
          {
            "name": "pagination.sort_by",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "pagination.descending",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "context.request_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.tenant_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.user_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.roles",
            "in": "query",
            "required": false,
            "explode": true,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          {
            "name": "context.idempotency_key",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.locale",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.timestamp",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "context.source_system",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "context.correlation_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "tags": [
          "QualityInspectionService"
        ]
      }
    },
    "/api/v1/manufacturing/make-usage-decision": {
      "post": {
        "summary": "对检验批做使用决策",
        "operationId": "QualityInspectionService_MakeUsageDecision",
        "responses": {
          "200": {
            "description": "A successful response.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/qualityMakeUsageDecisionResponse"
                }
              }
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/rpcStatus"
                }
              }
            }
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/qualityMakeUsageDecisionRequest"
              }
            }
          },
          "required": true
        },
        "tags": [
          "QualityInspectionService"
        ]
      }
    },
    "/api/v1/manufacturing/record-inspection-results": {
      "post": {
        "summary": "记录检验结果",
        "operationId": "QualityInspectionService_RecordInspectionResults",
        "responses": {
          "200": {
            "description": "A successful response.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/qualityRecordResultsResponse"
                }
              }
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/rpcStatus"
                }
              }
            }
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/qualityRecordResultsRequest"
              }
            }
          },
          "required": true
        },
        "tags": [
          "QualityInspectionService"
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "commonApiMessage": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string"
          },
          "code": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "target": {
            "type": "string"
          }
        }
      },
      "commonDateRange": {
        "type": "object",
        "properties": {
          "start_date": {
            "type": "string",
            "format": "date-time"
          },
          "end_date": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "commonInspectionLotOrigin": {
        "type": "string",
        "enum": [
          "INSPECTION_LOT_ORIGIN_UNSPECIFIED",
          "INSPECTION_LOT_ORIGIN_GOODS_RECEIPT",
          "INSPECTION_LOT_ORIGIN_PRODUCTION",
          "INSPECTION_LOT_ORIGIN_SUB_CONTRACTING",
          "INSPECTION_LOT_ORIGIN_STOCK_TRANSFER",
          "INSPECTION_LOT_ORIGIN_CUSTOMER_RETURN"
        ],
        "default": "INSPECTION_LOT_ORIGIN_UNSPECIFIED",
        "description": "- INSPECTION_LOT_ORIGIN_GOODS_RECEIPT: 收货\n - INSPECTION_LOT_ORIGIN_PRODUCTION: 生产\n - INSPECTION_LOT_ORIGIN_SUB_CONTRACTING: 外协\n - INSPECTION_LOT_ORIGIN_STOCK_TRANSFER: 库存转移\n - INSPECTION_LOT_ORIGIN_CUSTOMER_RETURN: 客户退货",
        "title": "检验批来源"
      },
      "commonPaginationRequest": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "page_size": {
            "type": "integer",
            "format": "int32"
          },
          "sort_by": {
            "type": "string"
          },
          "descending": {
            "type": "boolean"
          }
        }
      },
      "commonPaginationResponse": {
        "type": "object",
        "properties": {
          "current_page": {
            "type": "integer",
            "format": "int32"
          },
          "page_size": {
            "type": "integer",
            "format": "int32"
          },
          "total_items": {
            "type": "string",
            "format": "int64"
          },
          "total_pages": {
            "type": "integer",
            "format": "int32"
          }
        }
      },
      "commonQuantityValue": {
        "type": "object",
        "properties": {
          "unit_code": {
            "type": "string"
          },
          "value": {
            "type": "string"
          }
        }
      },
      "commonRequestContext": {
        "type": "object",
        "properties": {
          "request_id": {
            "type": "string"
          },
          "tenant_id": {
            "type": "string"
          },
          "user_id": {
            "type": "string"
          },
          "roles": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "idempotency_key": {
            "type": "string"
          },
          "locale": {
            "type": "string"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "source_system": {
            "type": "string"
          },
          "correlation_id": {
            "type": "string"
          }
        }
      },
      "commonSystemDocumentReference": {
        "type": "object",
        "properties": {
          "document_number": {
            "type": "string"
          },
          "fiscal_year": {
            "type": "integer",
            "format": "int32"
          },
          "company_code": {
            "type": "string"
          },
          "document_type": {
            "type": "string"
          },
          "document_category": {
            "type": "string"
          }
        }
      },
      "commonUsageDecision": {
        "type": "string",
        "enum": [
          "USAGE_DECISION_UNSPECIFIED",
          "USAGE_DECISION_ACCEPT",
          "USAGE_DECISION_REJECT",
          "USAGE_DECISION_CONDITIONAL",
          "USAGE_DECISION_SCRAP",
          "USAGE_DECISION_REWORK"
        ],
        "default": "USAGE_DECISION_UNSPECIFIED",
        "description": "- USAGE_DECISION_ACCEPT: 接受\n - USAGE_DECISION_REJECT: 拒绝\n - USAGE_DECISION_CONDITIONAL: 让步接收/有条件接受\n - USAGE_DECISION_SCRAP: 报废\n - USAGE_DECISION_REWORK: 返工",
        "title": "使用决策代码"
      },
      "protobufAny": {
        "type": "object",
        "properties": {
          "@type": {
            "type": "string"
          }
        },
        "additionalProperties": {}
      },
      "qualityCharacteristicResult": {
        "type": "object",
        "properties": {
          "characteristic_number": {
            "type": "string",
            "title": "特性编号"
          },
          "value": {
            "type": "string",
            "title": "记录的值"
          },
          "remark": {
            "type": "string",
            "title": "备注"
          }
        },
        "title": "特性结果"
      },
      "qualityCreateInspectionLotRequest": {
        "type": "object",
        "properties": {
          "material": {
            "type": "string"
          },
          "plant": {
            "type": "string"
          },
          "quantity": {
            "$ref": "#/components/schemas/commonQuantityValue"
          },
          "origin": {
            "$ref": "#/components/schemas/commonInspectionLotOrigin"
          },
          "source_document": {
            "$ref": "#/components/schemas/commonSystemDocumentReference"
          },
          "context": {
            "$ref": "#/components/schemas/commonRequestContext"
          }
        },
        "title": "创建检验批请求"
      },
      "qualityInspectionCharacteristic": {
        "type": "object",
        "properties": {
          "characteristic_number": {
            "type": "string",
            "title": "特性编号 (原: MERKNR)"
          },
          "description": {
            "type": "string",
            "title": "特性描述"
          },
          "inspection_method": {
            "type": "string",
            "title": "检验方法"
          },
          "result_value": {
            "type": "string",
            "title": "记录的检验结果"
          },
          "result_status": {
            "type": "string",
            "title": "结果状态 (例如, '2' for Processed, '5' for Valuated)"
          },
          "unit": {
            "type": "string",
            "title": "单位"
          }
        },
        "title": "检验特性 (参考: QAMR, QASR)"
      },
      "qualityInspectionLotDetail": {
        "type": "object",
        "properties": {
          "inspection_lot_number": {
            "type": "string",
            "title": "检验批号 (原: PRUEFLOS)"
          },
          "material": {
            "type": "string",
            "title": "物料编号 (原: MATNR)"
          },
          "plant": {
            "type": "string",
            "title": "工厂 (原: WERK)"
          },
          "lot_origin": {
            "$ref": "#/components/schemas/commonInspectionLotOrigin"
          },
          "lot_quantity": {
            "$ref": "#/components/schemas/commonQuantityValue"
          },
          "creation_date": {
            "type": "string",
            "format": "date-time",
            "title": "创建日期 (原: ENTSTEHDAT)"
          },
          "characteristics": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/qualityInspectionCharacteristic"
            },
            "title": "检验特性列表"
          },
          "usage_decision": {
            "$ref": "#/components/schemas/commonUsageDecision"
          }
        },
        "title": "检验批详情 (参考: QALS)"
      },
      "qualityInspectionLotResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "inspection_lot_number": {
            "type": "string"
          },
          "messages": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/commonApiMessage"
            }
          }
        },
        "title": "检验批响应"
      },
      "qualityListInspectionLotsResponse": {
        "type": "object",
        "properties": {
          "inspection_lots": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/qualityInspectionLotDetail"
            }
          },
          "pagination": {
            "$ref": "#/components/schemas/commonPaginationResponse"
          }
        },
        "title": "查询检验批响应"
      },
      "qualityMakeUsageDecisionRequest": {
        "type": "object",
        "properties": {
          "inspection_lot_number": {
            "type": "string",
            "title": "检验批号"
          },
          "decision_code": {
            "$ref": "#/components/schemas/commonUsageDecision"
          },
          "post_to_stock_type": {
            "type": "string",
            "title": "将合格品过账到的库存类型"
          },
          "note": {
            "type": "string",
            "title": "备注"
          },
          "context": {
            "$ref": "#/components/schemas/commonRequestContext"
          }
        },
        "title": "做使用决策请求"
      },
      "qualityMakeUsageDecisionResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "title": "操作是否成功"
          },
          "messages": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/commonApiMessage"
            },
            "title": "从核心ERP返回的消息列表"
          }
        },
        "title": "做使用决策响应"
      },
      "qualityRecordResultsRequest": {
        "type": "object",
        "properties": {
          "inspection_lot_number": {
            "type": "string",
            "title": "检验批号"
          },
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/qualityCharacteristicResult"
            },
            "title": "结果列表"
          },
          "context": {
            "$ref": "#/components/schemas/commonRequestContext"
          }
        },
        "title": "记录检验结果请求"
      },
      "qualityRecordResultsResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "title": "操作是否成功"
          },
          "messages": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/commonApiMessage"
            },
            "title": "从核心ERP返回的消息列表"
          }
        },
        "title": "记录检验结果响应"
      },
      "rpcStatus": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "details": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/protobufAny"
            }
          }
        }
      }
    },
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Enter your JWT token (e.g. from Login API)"
      }
    }
  },
  "security": [
    {
      "BearerAuth": []
    }
  ]
}